# PDI Consent Modal Web Component

This repository contains a web component for a consent modal, designed to guide users through consent management processes. The modal facilitates consent granting and displays relevant information regarding data usage and privacy.

## How to Use

### Installation

#### Through the VisionsTrust service
1. Include the script at the top of any HTML file
```html
<script src="https://api.visionstrust.com/assets/modal.js" type="text/javascript" defer></script>
```

#### Or download the js file
1. Download the ``modal.js`` file from this repository
2. Link it to your html file however you like

### Usage
You can now use the consent-modal html tag
```html
<consent-modal></consent-modal>
```
You can customize the button to open the consent modal with the slot “buttonOpenModal”
```html
<consent-modal>
    <button slot="buttonOpenModal">Custom open</button>
</consent-modal>
```

### Customizing Branding
The component can be customized to fit the branding of your application.
In order to do that, the data-branding attribute can be used. It takes as a value a JSON stringified branding object. An easy way to set this up is by defining a branding object and setting the attribute using javascript.

An example of this method is found below
```html
<consent-modal id="my-consent-modal"></consent-modal>

<script>
    const branding = {
        img: {
            // Your source path
            src: "",
            // Your text alt
            alt: "",
            size: {
                // Value in px,rem,em,etc for all keys
                width: "",
                height: "",
                translateY: "",
            },
        },
        // Your hexa or rgba colors
        colors: {
            primary: "",
            secondary: "",
            tertiary: "",
            // This gradient key is the color of the background header
            // You can use gradient color or hexa color
            gradient: "",
            bgOpacity: "",
            buttonText: {
                initial: "",
                hover: "",
            },
            // This value concern element to be selected
            active: {
                background: "",
                text: "",
            },
        },
    };

    const modal = document.getElementById("my-consent-modal");
    modal.setAttribute("data-branding", JSON.stringify(branding));
</script>
```

### CORS configuration
To enable the consent-modal to communicate securely with your PDC, you need to create a [CORS configuration](https://github.com/Prometheus-X-association/dataspace-connector/blob/main/docs/CORS.md) on your PDC to enable the consent-modals that are hosted on a specific origin to be allowed to communicate with your PDC.

### Communication with the connector
The goal of the component is to help in streamlining the actions to take by the individual to load privacy notices and grant his consent. There are 2 major flows made possible.

#### Controlled Privacy Notice
In the simplified UX flow, the participant is in charge of loading the available exchanges (contracts) and the expected privacy notice in the backend prior to displaying the consent-modal to the individual.

This flow:
* Requires the participant to fetch information prior to enabling the consent popup (as defined in [this guide](https://gist.github.com/Visions-Felix/266eeb318e5fe795fb5b59c0de9dc8bd))
* Is a simpler UX for individuals
* Enables participants to configure a consent-modal for a single controlled data exchange

For this flow to take place, the consent-modal should be configured like so:
```html
<consent-modal
    id="my-consent-modal"
    data-privacyNoticeEndpoint=""
    data-consentGrantEndpoint=""
    data-PDCAdminJWT="" 
    data-userIdentifier=""
>
    <button slot="buttonOpenModal">Custom open</button>
</consent-modal>
```
Attribute|Description
|-|-|
privacyNoticeEndpoint|Endpoint to load the appropriate privacy notice. This element is recuperated from the flow defined in this [guide](https://gist.github.com/Visions-Felix/266eeb318e5fe795fb5b59c0de9dc8bd)
consentGrandEndpoint|Endpoint from your [PDC](https://github.com/Prometheus-X-association/dataspace-connector) for consent grant. Follow your PDC swagger docs, the endpoint should be `${YOUR_PDC_ENDPOINT}/private/consent`.
PDCAdminJWT|The JWT generated by your PDC when registering a [CORS configuration](https://github.com/Prometheus-X-association/dataspace-connector/blob/main/docs/CORS.md)
userIdentifier|The internal ID of the individual for whom the consent modal should be generated (the ID from your system that you registered in the PDC).

#### Free Selection of Privacy Notice
In this second flow, the UX is a little more complex but allows more freedom in the individual's selection of what data to share. 

This flow makes it so that the consent-modal takes the user to 2 additionnal screens before displaying the selected privacy notice. These actions are essentially what the participant does in the backend in the Controlled Privacy Notice flow:
1. Display and selection of available exchanges
2. Display and selection of available privacy notices to give

After these 2 screens, the consent-modal will display the selected Privacy Notice information.

In order to use this flow, the consent-modal should be configured a little bit differently
```html
<consent-modal
    id="my-consent-modal"
    data-availableExchangesEndpoint=""
    data-consentGrantEndpoint=""
    data-PDCAdminJWT="" 
    data-userIdentifier=""
>
    <button slot="buttonOpenModal">Custom open</button>
</consent-modal>
```
Most of the attributes are the same as the first flow, however the privacyNoticeEndpoint should not be included and the availableExchangesEndpoint should be added instead.

Attribute|Description
|-|-|
availableExchangesEndpoint|Endpoint to load the available exchanges. This element is representing the step to get available exchanges defined in this [guide](https://gist.github.com/Visions-Felix/266eeb318e5fe795fb5b59c0de9dc8bd)


And that's it ! The consent-modal handles all the rest.